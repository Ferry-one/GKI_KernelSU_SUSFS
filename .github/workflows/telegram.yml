name: Telegram Notifier
on:
  workflow_run:
    workflows: ["ÁºñËØëÂÜÖÊ†∏a15-6-6", "Android 15 6.6"]
    types: [completed]

jobs:
  send-notification:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Send to Telegram
        env:
          CHAT_ID: ${{ secrets.CHAT_ID }}
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        run: |
          # Cari file ZIP
          ZIP_FILE=$(find . -name "*.zip" | head -n 1)
          
          # Dapetin info dari workflow_run
          WORKFLOW_NAME="${{ github.event.workflow_run.name }}"
          RUN_URL="${{ github.event.workflow_run.html_url }}"
          
          # Buat pesan sederhana
          MESSAGE="‚úÖ *Kernel Build Success*

üè∑Ô∏è Workflow: $WORKFLOW_NAME
üì¶ File: $(basename "$ZIP_FILE")
üîó [View Log]($RUN_URL)"

          # Kirim file + pesan ke Telegram
          if [ -f "$ZIP_FILE" ]; then
            curl -F document=@"$ZIP_FILE" \
                 -F caption="$MESSAGE" \
                 -F parse_mode="Markdown" \
                 "https://api.telegram.org/bot$BOT_TOKEN/sendDocument?chat_id=$CHAT_ID"
          else
            curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
              -d chat_id="$CHAT_ID" \
              -d text="‚úÖ Kernel Build Success - $WORKFLOW_NAME" \
              -d parse_mode="Markdown"
          fi
